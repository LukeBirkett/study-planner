<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sandbox_V1_4.DisturbanceSource &mdash; Sandbox 1.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=0ed52906"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Sandbox
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">General information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../systems.html">Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stimuli_sensors.html">Sources of stimuli and sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../agents.html">Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../actuators.html">Actuators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../environment.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../noise_sources.html">Sources of noise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../disturbance_sources.html">Disturbances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simulation.html">Simulation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Sandbox</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">Sandbox_V1_4.DisturbanceSource</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for Sandbox_V1_4.DisturbanceSource</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">.System</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.noise</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.Robot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.stimuli</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">copy</span> <span class="k">as</span> <span class="nn">cp</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<div class="viewcode-block" id="DisturbanceSource">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.DisturbanceSource">[docs]</a>
<span class="k">class</span> <span class="nc">DisturbanceSource</span><span class="p">(</span><span class="n">System</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An abstract superclass for timed sources of disturbances. A :class:`DisturbanceSource` is a subclass of :class:`System`, which has no position.</span>

<span class="sd">        Subclasses of :class:`DisturbanceSource` must call its ``step()`` method using ``super().step(dt)``, so that disturbances are enabled and disabled at the right times.</span>

<span class="sd">        When the :class:`DisturbanceSource` is constructed, it is passed lists of times at which to be activated (enabled) and deactivated (disabled). A :class:`DisturbanceSource` is disabled by default when first created. When a :class:`DisturbanceSource` is active, the list of times to disable it is monitored, and when it is not active, the list of times to enable it is monitored. When the :class:`DistubanceSource`&#39;s internal clock, ``t``, exceeds the first time in the currently monitored list, then the :class:`DisturbanceSource` will be enabled/disabled as appropriate. When this happens, the listed time which has just been used will be removed from the list, so that the next time in the list (if there is one) will become the first element in the list.</span>

<span class="sd">        As it is always the first elements in the two lists which are monitored, the two together must be ordered correctly with respect to time. For example, if ``start_times = [100, 200]`` and ``end_times = [50, 130]``, then the disturbance will be activated at t &gt;= 100, and then deactivated in the next simulation step, as then t &gt; 100 &gt; 50. Then the same thing will happen again, at t &gt;= 200 and in the following simulation step, because 200 &gt; 130.</span>

<span class="sd">        If no end_times are specified, then once any disturbance is active, it will be so until the simulation ends. If you have more start times than end times, and they are appropriately sequenced, then there will be a time at which the disturbance will be activated without ever being deactivated again. For example, if ``start_times = [100, 200, 500]`` and ``end_times = [150, 300]``, then the disturbance will be enabled and disabled twice, and then be enabled from t = 500 until the simulation ends (assuming that the simulation duration &gt; 500).</span>

<span class="sd">        If you would like a disturbance to be &#39;one-shot&#39;, i.e. only active for a single simulation step, then the easiest way to implement that is in the step() method of the subclass of :class:`DisturbanceSource`, e.g. as in the :class:`SensoryInversionDisturbanceSource` class ``step()`` method, where whenever the disturbance is applied, ``self.enabled`` is subsequently set to ``False`` to disable it again.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># construct disturbance source</span>
<div class="viewcode-block" id="DisturbanceSource.__init__">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.DisturbanceSource.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="p">[],</span> <span class="n">stop_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="p">[],</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __init__(start_times: List[int]=[], stop_times: List[int]=[], enabled: bool=True)</span>

<span class="sd">            :param start_times: The list of times at which a :class:`DisturbanceSource` is activated.</span>
<span class="sd">            :type start_time: list[int]</span>

<span class="sd">            :param stop_times: The list of times at which a :class:`DisturbanceSource` is deactivated.</span>
<span class="sd">            :type stop_times: list[int]</span>

<span class="sd">            :param enabled: A parameter which determines whether or not a :class:`DisturbanceSource` is active. The :class:`DisturbanceSource` manages this variable itself. In most cases, it will be best to leave this variable as ``False`` when a :class:`DisturbanceSource` is constructed, and only use ``start_times`` and ``stop_times`` to inform the disturbance source when to change it.</span>
<span class="sd">            :type enabled: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span>
        <span class="k">if</span> <span class="n">start_times</span><span class="p">:</span>  <span class="c1"># if any start_times are passed in, then the disturbance is initially disabled, and it will not be enabled until the first start time is reached</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># DisturbanceSources keep track of time internally. a number of classes do this, and it is certainly not the most computationally efficient approach, but it avoids using a global time variable (which could be horrendous)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_times</span> <span class="o">=</span> <span class="n">start_times</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_times</span> <span class="o">=</span> <span class="n">stop_times</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span>

        <span class="c1"># I CAN DIRECTLY COPY THESE LISTS?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_start_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">start_times</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_start_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_stop_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stop_times</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_stop_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>


<div class="viewcode-block" id="DisturbanceSource.step">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.DisturbanceSource.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Step the disturbance source forwards in time. This is where the disturbance gets enabled and disabled. The effect of the disturbance is be implemented in the step methods for the subclasses of DisturbancSource</span>

<span class="sd">            :param dt: Interval of time to integrate the disturbance source over.</span>
<span class="sd">            :type dt: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>  <span class="c1"># increment time variable by simulatino step size</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_times</span><span class="p">:</span>  <span class="c1"># if the disturbance is enabled, then check if stop_times is empty, and if it is, then there is nothing left to do, so just return</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># otherwise, check to see if it is time to disable the disturbance yet</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># always get the end_time at the beginning of the list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stop_times</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># every time an end time is used, it is removed (popped) from the list as it will not be used again</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_times</span><span class="p">:</span>  <span class="c1"># if the disturbance is disabled but there are no start_times remaining, then there is nothing left to do, so just return</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># otherwise, check to see if it is time to enable the disturbance yet</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># always get the start_time at the beginning of the list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">start_times</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># every time a start time is used, it is removed (popped) from the list as it will not be used again</span></div>


<div class="viewcode-block" id="DisturbanceSource.reset">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.DisturbanceSource.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reset DisturbanceSource by resetting its timer, enabled state and start/stop time lists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_times</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_start_times</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_stop_times</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="MovingSensorsDisturbanceSource">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.MovingSensorsDisturbanceSource">[docs]</a>
<span class="k">class</span> <span class="nc">MovingSensorsDisturbanceSource</span><span class="p">(</span><span class="n">DisturbanceSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A disturbance source class for making a :class:`Robot`&#39;s light sensors gradually change, through</span>
<span class="sd">        small random movements, their angular position on the robot&#39;s body. The</span>
<span class="sd">        sensors will always be the body&#39;s perimeter, and change their orientations to</span>
<span class="sd">        match their new angular positions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># construct disturbance source</span>
<div class="viewcode-block" id="MovingSensorsDisturbanceSource.__init__">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.MovingSensorsDisturbanceSource.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">:</span> <span class="n">Robot</span><span class="p">,</span>
                        <span class="n">max_move</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">36</span><span class="p">,</span>
                        <span class="n">move_left</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">move_right</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">start_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">stop_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">sensor_indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __init__(robot, max_move=np.pi/36, move_left=True, move_right=True, start_times=[], stop_times=[], enabled=True, sensor_indices=[3, 4])</span>

<span class="sd">            :param robot: The class:`Robot` instance which will be disturbed.</span>
<span class="sd">            :type robot: class:`Robot`</span>

<span class="sd">            :param max_move: The maximum angle by which a sensor will move in a single simulation step.</span>
<span class="sd">            :type max_move: float</span>

<span class="sd">            :param move_left: Not used in this implementation.</span>
<span class="sd">            :type move_left: bool</span>

<span class="sd">            :param move_right: Not used in this implementation.</span>
<span class="sd">            :type move_right: bool</span>

<span class="sd">            :param start_times: The list of times at which a :class:`DisturbanceSource` is activated.</span>
<span class="sd">            :type start_time: list[int]</span>

<span class="sd">            :param stop_times: The list of times at which a :class:`DisturbanceSource` is deactivated.</span>
<span class="sd">            :type stop_times: list[int]</span>

<span class="sd">            :param enabled: A parameter which determines whether or not a :class:`DisturbanceSource` is active.</span>

<span class="sd">            :param sensor_indices: The indices of the sensors, in the robot&#39;s sensor list, which will be disturbed.</span>
<span class="sd">            :type sensor_indices: list[int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">stop_times</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_left</span> <span class="o">=</span> <span class="n">move_left</span>  <span class="c1"># left sensor will be affected, if this is True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_right</span> <span class="o">=</span> <span class="n">move_right</span>  <span class="c1"># right sensor will be affectd, if this is True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noisesource</span> <span class="o">=</span> <span class="n">WhiteNoiseSource</span><span class="p">(</span><span class="n">min_val</span><span class="o">=-</span><span class="n">max_move</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="n">max_move</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sensor_indices</span> <span class="o">=</span> <span class="n">sensor_indices</span></div>


<div class="viewcode-block" id="MovingSensorsDisturbanceSource.step">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.MovingSensorsDisturbanceSource.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Step :class:`MovingSensorsDisturbanceSource` forwards in time. The sensors specified in ``sensor_indices`` will be moved by a random amount whenever the disturbance source is enabled.</span>

<span class="sd">            :param dt: Interval of time to integrate the disturbance source over.</span>
<span class="sd">            :type dt: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensor_indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">sensor_angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noisesource</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovingSensorsDisturbanceSource.reset">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.MovingSensorsDisturbanceSource.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reset DisturbanceSource by resetting its timer, enabled state and start/stop time lists, as well as its noise source.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noisesource</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>
</div>


<div class="viewcode-block" id="SensoryInversionDisturbanceSource">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.SensoryInversionDisturbanceSource">[docs]</a>
<span class="k">class</span> <span class="nc">SensoryInversionDisturbanceSource</span><span class="p">(</span><span class="n">DisturbanceSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A disturbance source class for switching the positions of two of a :class:`Robot`&#39;s sensors.</span>

<span class="sd">        An example of how this will often be used is in a :class:`Robot` with two</span>
<span class="sd">        :class:`LightSensor` s, like Braitenberg&#39;s light-seeking and light-avoiding vehicles. Braitenberg&#39;s *aggressor* (light-seeker) can be turned into his *coward* (light-avoider) simply by changing its sensorimotor connections from crossed to direct. Keeping the connections the same and swapping the positions of the sensors has the same effect.</span>

<span class="sd">        For a :class:`Robot` with more than two sensors, this disturbance source can be used with any pair, specified by ``sensor_indices`` when the :class:`SensoryInversionDisturbanceSource` is constructed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># construct disturbance source</span>
<div class="viewcode-block" id="SensoryInversionDisturbanceSource.__init__">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.SensoryInversionDisturbanceSource.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">:</span> <span class="n">Robot</span><span class="p">,</span> <span class="n">start_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">sensor_indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __init__(robot, start_times, sensor_indices=[0, 1])</span>

<span class="sd">            :param robot: The :class:`Robot` which will be disturbed.</span>
<span class="sd">            :type robot: :class:`Robot`</span>

<span class="sd">            :param start_times: The list of times at which a :class:`DisturbanceSource` is activated.</span>
<span class="sd">            :type start_time: list[int]</span>

<span class="sd">            :param sensor_indices: The indices of the two sensors which will have their positions switched. Defaults to ``[3,4]``, which are often the indices of the first two light sensors on a ``Robot``.</span>
<span class="sd">            :type sensor_indices: list[int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>  <span class="c1"># the robot which will be disturbed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sensor_indices</span> <span class="o">=</span> <span class="n">sensor_indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_angles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">sensor_angles</span></div>


<div class="viewcode-block" id="SensoryInversionDisturbanceSource.step">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.SensoryInversionDisturbanceSource.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Step :class:`SensoryInversionDisturbanceSource` forwards in time. When the disturbance source becomes enabled, the sensors will be switched, and then the disturbance source will immediately be disabled again.</span>

<span class="sd">            :param dt: Interval of time to integrate the disturbance source over.</span>
<span class="sd">            :type dt: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>  <span class="c1"># rewire connections between sensor and motors</span>
            <span class="c1"># swap sensor angles</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">sensor_angles</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sensor_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">sensor_angles</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sensor_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">sensor_angles</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sensor_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">sensor_angles</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sensor_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">temp</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># unlike a generic DisturbanceSource, this is a one-shot disturbance, and so is automatically disabled immediately after being applied</span></div>


<div class="viewcode-block" id="SensoryInversionDisturbanceSource.reset">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.SensoryInversionDisturbanceSource.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reset DisturbanceSource by resetting its timer, enabled state and start/stop time lists, as well as robot sensor angles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">sensor_angles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_angles</span></div>
</div>


<div class="viewcode-block" id="LightSwitcherDisturbanceSource">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.LightSwitcherDisturbanceSource">[docs]</a>
<span class="k">class</span> <span class="nc">LightSwitcherDisturbanceSource</span><span class="p">(</span><span class="n">DisturbanceSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A disturbance source class for switching the colours of lights from red to yellow, and vice versa.</span>

<span class="sd">        The light sources which will be disturbed should have both of their ``colour`` and ``label`` parameters set to either &#39;red&#39; or &#39;yellow&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="LightSwitcherDisturbanceSource.__init__">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.LightSwitcherDisturbanceSource.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">light_sources</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LightSource</span><span class="p">],</span> <span class="n">start_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">switch_colours</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __init__(light_sources: List[LightSource], start_times: List[int], switch_colours: List[str]=[&#39;red&#39;, &#39;yellow&#39;])</span>

<span class="sd">            :param light_sources: The list of light sources which will be disturbed.</span>
<span class="sd">            :type light_sources: list[:class:`LightSource`]</span>

<span class="sd">            :param start_times: The list of times at which a :class:`DisturbanceSource` is activated.</span>
<span class="sd">            :type start_time: list[int]</span>

<span class="sd">            :param switch_colours: The two colours which the light sources will be switched between.</span>
<span class="sd">            :type switch_colours: list[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span> <span class="o">=</span> <span class="n">light_sources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_colours</span> <span class="o">=</span> <span class="n">switch_colours</span></div>


<div class="viewcode-block" id="LightSwitcherDisturbanceSource.step">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.LightSwitcherDisturbanceSource.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Step :class:`LightSwitcherDisturbanceSource` forwards in time. When the disturbance source becomes enabled, the lights will be switched, and then the disturbance source will imeediately be disabled again.</span>

<span class="sd">            :param dt: Interval of time to integrate the disturbance source over.</span>
<span class="sd">            :type dt: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;red&#39;</span><span class="p">:</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span>
                <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;yellow&#39;</span><span class="p">:</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># unlike a generic DisturbanceSource, this is a one-shot disturbance, and so is automatically disabled immediately after being applied</span></div>


<div class="viewcode-block" id="LightSwitcherDisturbanceSource.reset">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.LightSwitcherDisturbanceSource.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reset DisturbanceSource by resetting its timer, enabled state and start/stop time lists, as well as restoring lights to their riginal states.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>
</div>


<div class="viewcode-block" id="ParameterDisturbanceSource">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.ParameterDisturbanceSource">[docs]</a>
<span class="k">class</span> <span class="nc">ParameterDisturbanceSource</span><span class="p">(</span><span class="n">DisturbanceSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A subclass of :class:`DisturbanceSource` which disturbs the parameters of a :class:`Controller`, moving them by some random distance in every simulation step when the disturbance is active. This is a one-shot disturbance, so it is triggered for every point of time specified in ``start_times``, but always disabled immediately thereafter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ParameterDisturbanceSource.__init__">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.ParameterDisturbanceSource.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">start_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __init__(controller: Controller, start_times: List[int], enabled: bool=True)</span>

<span class="sd">            :param controller: The :class:`Controller` to be disturbed.</span>
<span class="sd">            :type controller: :class:`Controller`</span>

<span class="sd">            :param start_times: The list of times at which the :class:`DisturbanceSource` is activated.</span>
<span class="sd">            :type start_time: list[int]</span>

<span class="sd">            :param stop_times: The list of times at which the :class:`DisturbanceSource` is deactivated.</span>
<span class="sd">            :type stop_times: list[int]</span>

<span class="sd">            :param enabled: The parameter which determines whether or not the :class:`DisturbanceSource` is active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">start_times</span><span class="o">=</span><span class="n">start_times</span><span class="p">,</span> <span class="n">stop_times</span><span class="o">=</span><span class="p">[],</span> <span class="n">enabled</span><span class="o">=</span><span class="n">enabled</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">noisesource</span> <span class="o">=</span> <span class="n">WhiteNoiseSource</span><span class="p">(</span><span class="n">min_val</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="ParameterDisturbanceSource.step">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.ParameterDisturbanceSource.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Step :class:`ParameterDisturbanceSource` forwards in time. The disturbed controller&#39;s parameters will be disturbed by a random amount, drawn from a uniform distirbution on the interval [-2, 2], whenever the disturbance source is enabled.</span>

<span class="sd">            :param dt: Interval of time to integrate the disturbance source over.</span>
<span class="sd">            :type dt: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="c1"># print(self.controller.params)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">params</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noisesource</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
            <span class="c1"># print(self.controller.params)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># unlike a generic DisturbanceSource, this is a one-shot disturbance, and so is automatically disabled immediately after being applied</span></div>


<div class="viewcode-block" id="ParameterDisturbanceSource.reset">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.ParameterDisturbanceSource.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reset disturbance, so it can be re-used in later simulations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_params</span></div>
</div>


<div class="viewcode-block" id="MotorNoiseDisturbanceSource">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.MotorNoiseDisturbanceSource">[docs]</a>
<span class="k">class</span> <span class="nc">MotorNoiseDisturbanceSource</span><span class="p">(</span><span class="n">DisturbanceSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A class for applying a noise signal generated by a :class:`NoiseMaker` to the speed of a :class:`Motor`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># construct disturbance source</span>
<div class="viewcode-block" id="MotorNoiseDisturbanceSource.__init__">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.MotorNoiseDisturbanceSource.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">white_noise_params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                 <span class="n">brown_noise_step</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">spike_noise_params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                 <span class="n">start_times</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">stop_times</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __init__(self, motor, white_noise_params: List[float]=[0.0, 0.0], brown_noise_step: float=0, spike_noise_params: List[float]=[0.0, 0.0, 0.0], start_times=[], stop_times=[], enabled=False)</span>

<span class="sd">            :param motor: The :class:`Motor` to be disturbed.</span>
<span class="sd">            :type motor: :class:`Motor`</span>

<span class="sd">            :param white_noise_params: Parameters for the :class:`WhiteNoiseSource` component of the :class:`NoiseMaker`.</span>
<span class="sd">            :type white_noise_params: list[float]</span>

<span class="sd">            :param spike_noise_params: Parameters for the :class:`SpikeNoiseSource` component of the :class:`NoiseMaker`.</span>
<span class="sd">            :type spike_noise_params: list[float]</span>

<span class="sd">            :param brown_noise_step: The maximum amount by which the :class:`BrownNoiseSource` component of the :class:`NoiseMaker` can move in each step.</span>

<span class="sd">            :param start_times: The list of times at which the :class:`DisturbanceSource` is activated.</span>
<span class="sd">            :type start_time: list[int]</span>

<span class="sd">            :param stop_times: The list of times at which the :class:`DisturbanceSource` is deactivated.</span>
<span class="sd">            :type stop_times: list[int]</span>

<span class="sd">            :param enabled: The parameter which determines whether or not the :class:`DisturbanceSource` is active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">stop_times</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span> <span class="o">=</span> <span class="n">motor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noisesource</span> <span class="o">=</span> <span class="n">NoiseMaker</span><span class="p">(</span><span class="n">white_noise_params</span><span class="p">,</span> <span class="n">brown_noise_step</span><span class="p">,</span> <span class="n">spike_noise_params</span><span class="p">)</span></div>


    <span class="c1"># step disturbance</span>
<div class="viewcode-block" id="MotorNoiseDisturbanceSource.step">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.MotorNoiseDisturbanceSource.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Step :class:`MotorNoiseDisturbanceSource` forwards in time. The disturbed motor&#39;s speed will be disturbed by adding noise whenever the disturbance source is enabled.</span>

<span class="sd">            :param dt: Interval of time to integrate the disturbance source over.</span>
<span class="sd">            :type dt: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">speed</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noisesource</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></div>


<div class="viewcode-block" id="MotorNoiseDisturbanceSource.reset">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.MotorNoiseDisturbanceSource.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reset disturbance, so it can be re-used in later simulations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>
</div>


<div class="viewcode-block" id="PathDisturbanceSource">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.PathDisturbanceSource">[docs]</a>
<span class="k">class</span> <span class="nc">PathDisturbanceSource</span><span class="p">(</span><span class="n">DisturbanceSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A disturbance source class for disturbing a closed path of lights. While the disturbance is active, the path will be gradually deformed.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="PathDisturbanceSource.__init__">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.PathDisturbanceSource.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">light_sources</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LightSource</span><span class="p">],</span> <span class="n">start_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">stop_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n_points</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            __init__(self, light_sources: List[LightSource], start_times: List[int], stop_times: List[int], n_points: int, enabled=False, d=0.1)</span>

<span class="sd">            :param light_sources: The list of light sources which will be disturbed.</span>
<span class="sd">            :type light_sources: list[:class:`LightSource`]</span>

<span class="sd">            :param start_times: The list of times at which a :class:`DisturbanceSource` is activated.</span>
<span class="sd">            :type start_time: list[int]</span>

<span class="sd">            :param stop_times: The list of times at which a :class:`DisturbanceSource` is deactivated.</span>
<span class="sd">            :type stop_times: list[int]</span>

<span class="sd">            :param enabled: A parameter which determines whether or not a :class:`DisturbanceSource` is active.</span>

<span class="sd">            :param d: A parameter which affects (nonlinearly) how much a path can be disturbed. Defaults to ``0.1``.</span>
<span class="sd">            :type d: float</span>

<span class="sd">            :param n_points: The number of control points which will initially be moved when the path is deformed.</span>
<span class="sd">            :type n_points: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">stop_times</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span> <span class="o">=</span> <span class="n">light_sources</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">light_sources</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">neighbourhood</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">neighbourhood</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">neighbourhood</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neighbourhood</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">l</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_points</span> <span class="o">=</span> <span class="n">n_points</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">signs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">n_points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">n_points</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">centroidx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centroidy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centroidx</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centroidy</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centroidx</span> <span class="o">/=</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centroidy</span> <span class="o">/=</span> <span class="n">l</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">avg_dist</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avg_dist</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">centroidx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">centroidy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avg_dist</span> <span class="o">/=</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_dist</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span></div>


<div class="viewcode-block" id="PathDisturbanceSource.step">
<a class="viewcode-back" href="../../disturbance_sources.html#Sandbox_V1_4.PathDisturbanceSource.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Step :class:`PathDisturbanceSource` forwards in time. When the disturbance source becomes enabled, the path of lights will be repeatedly deformed (and gradually, as long as the ``d`` parameter is small enough).</span>

<span class="sd">            :param dt: Interval of time to integrate the disturbance source over.</span>
<span class="sd">            :type dt: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">):</span>
                <span class="c1"># print(j)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">p</span>
                <span class="c1"># d = 0.4</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">random_in_interval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signs2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">random_in_interval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>

                <span class="n">neighbour1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">neighbour11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">[</span><span class="n">neighbour1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">neighbour12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">[</span><span class="n">neighbour1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">neighbour2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">neighbour21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">[</span><span class="n">neighbour2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">neighbour22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">[</span><span class="n">neighbour2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour1</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour1</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
                <span class="n">d1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour2</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour2</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
                <span class="n">d2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">d2</span> <span class="o">&gt;</span> <span class="n">d1</span><span class="p">:</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">x2</span> <span class="o">*</span> <span class="mf">0.1</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">y2</span> <span class="o">*</span> <span class="mf">0.1</span>
                <span class="k">else</span><span class="p">:</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">x1</span> <span class="o">*</span> <span class="mf">0.1</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">y1</span> <span class="o">*</span> <span class="mf">0.1</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour1</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour11</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour12</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour1</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour11</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour12</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="n">neighbour2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">neighbour21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">[</span><span class="n">neighbour2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">neighbour22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">[</span><span class="n">neighbour2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour2</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour21</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour22</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour2</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour21</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">[</span><span class="n">neighbour22</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">centroidx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">centroidy</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">centroidx</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">centroidy</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">y</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">centroidx</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">centroidy</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span>

                <span class="n">avg_dist</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">centroidx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">centroidy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="c1"># print(d)</span>
                    <span class="n">avg_dist</span> <span class="o">+=</span> <span class="n">d</span>
                <span class="n">avg_dist</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_dist</span> <span class="o">/</span> <span class="n">avg_dist</span>
                <span class="c1"># print(ratio)</span>
                <span class="c1"># print(self.l, self.ffs, avg_dist)</span>

                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_sources</span><span class="p">:</span>
                    <span class="n">vx</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroidx</span>
                    <span class="n">vy</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroidy</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">vx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroidx</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">vy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroidy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_points</span><span class="p">)</span></div>
</div>


<span class="c1"># # broken by updates to Robot</span>
<span class="c1"># class SensorLabelSwitcherDisturbance(DisturbanceSource):</span>
<span class="c1">#     &#39;&#39;&#39;</span>
<span class="c1">#         A &quot;one-shot&quot; disturbance source which changes the labels of the disturbed :class:`Robot`&#39;s sensors, so that the :class:`LightSource` s which they detect are changed, according to the list of labels passed to the :class:`DisturbanceSource`&#39;s constructor.</span>

<span class="c1">#         Similar in effect to :class:`LightSwitcherDisturbanceSource`, except that more than two labels can be used here. For example, if the ``labels`` list is ``[&#39;yellow&#39;, &#39;red&#39;, &#39;food&#39;]``, the sensors&#39; labels will cycle through ``&#39;yellow&#39;``, ``&#39;red&#39;``, ``&#39;food&#39;``, ``&#39;yellow&#39;``, and so on.</span>
<span class="c1">#     &#39;&#39;&#39;</span>

<span class="c1">#     def __init__(self, robot: Robot, start_times: List[int], labels: List[str]=[&#39;yellow&#39;,&#39;red&#39;], enabled: bool=True):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#             __init__(robot: Robot, start_times: List[int], labels: List[str]=[&#39;yellow&#39;,&#39;red&#39;], enabled: bool=True)</span>

<span class="c1">#             :param robot: The :class:`Robot` to be disturbed.</span>
<span class="c1">#             :type robot: :class:`Robot`</span>

<span class="c1">#             :param start_times: The list of times at which a :class:`DisturbanceSource` is activated.</span>
<span class="c1">#             :type start_time: list[int]</span>

<span class="c1">#             :param stop_times: The list of times at which a :class:`DisturbanceSource` is deactivated.</span>
<span class="c1">#             :type stop_times: list[int]</span>

<span class="c1">#             :param enabled: A parameter which determines whether or not a :class:`DisturbanceSource` is active.</span>

<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         super().__init__(start_times=start_times, stop_times=[], enabled=enabled)</span>
<span class="c1">#         self.robot = robot</span>
<span class="c1">#         self.labels = labels</span>
<span class="c1">#         self.labels_ind: int = 0</span>
<span class="c1">#         self.labels_n = len(labels)</span>

<span class="c1">#     def step(self, dt: float) -&gt; None:</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#             Step :class:`SensorLabelSwitcherDisturbance` forwards in time. When the disturbance source becomes enabled, the lights which the sensor detects will be switched to the next in the list of labels (which will be the first in the list, if the end has already been reached), and then the disturbance source will immediately be disabled again.</span>

<span class="c1">#             :param dt: Interval of time to integrate the disturbance source over.</span>
<span class="c1">#             :type dt: float</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         super().step(dt)</span>

<span class="c1">#         if self.enabled:</span>

<span class="c1">#             # print(&#39;i\&#39;m disturbed at &#39;, self.t)</span>

<span class="c1">#             for s in self.robot.sensors:</span>
<span class="c1">#                 s.label = self.labels[self.labels_ind % self.labels_n]</span>

<span class="c1">#             self.labels_ind += 1</span>

<span class="c1">#             self.enabled = False</span>

<span class="c1">#     def reset(self) -&gt; None:</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#             Reset disturbance, so it can be re-used.</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         super().reset()</span>

<span class="c1">#         self.labels_ind = 0</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Chris Johnson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>